(function(window, angular, undefined) {
'use strict';
angular.module("keepr.ngOfflineModel",[]),angular.module("keepr.ngOfflineModel").service("CryptoOfflineStorage",function(){var loadCrypto="undefined"!=typeof CryptoJS;return{secret:"",storageType:"localStorage",init:function(opts){angular.extend(this,opts)},encrypt:function(object,secret){var message=loadCrypto?JSON.stringify(object):object;return loadCrypto?CryptoJS.TripleDES.encrypt(message,secret):JSON.stringify(object)},decrypt:function(encrypted,secret){if("undefined"==typeof encrypted)return"";var decrypted=loadCrypto?CryptoJS.TripleDES.decrypt(encrypted,secret):JSON.parse(encrypted);return loadCrypto?JSON.parse(decrypted.toString(CryptoJS.enc.Utf8)):decrypted},get:function(key){var encrypted=window[this.storageType].getItem(key);return encrypted&&this.decrypt(encrypted,this.secret)},set:function(key,object){if(!object)return this.remove(key),!1;var encrypted=this.encrypt(object,this.secret);return window[this.storageType].setItem(key,encrypted),!0},remove:function(key){return window[this.storageType].removeItem(key),!0},clearAll:function(){return window[this.storageType].clear(),!0}}}),angular.module("keepr.ngOfflineModel").factory("ngOfflineModel",function(CryptoOfflineStorage){var maxListItems=function(input,elementKey){var out;if(input){(void 0===elementKey||null===elementKey)&&(elementKey=!1);for(var i in input)elementKey?"undefined"!=typeof input[i][elementKey]&&(input[i][elementKey]>out||void 0===out||null===out)&&(out=input[i][elementKey]):(input[i]>out||void 0===out||null===out)&&(out=input[i]);return out}},_items=null,_storageType="localStorage";return{primaryKey:"_id",fields:null,key:null,secret:"my-awesome-key",init:function(_items,params){var self=this;params=params||{},angular.extend(self,params),CryptoOfflineStorage.storageType=_storageType,CryptoOfflineStorage.init({secret:this.secret});var _itemsCached=CryptoOfflineStorage.get(this.key);if(null!==_itemsCached?_items=_itemsCached:angular.isArray(_items)||(_items=[]),null!==this.fields)for(var _itemsLength=_items.length,i=0;_itemsLength>i;i++)_items[i]=this.createValueObject(_items[i]);return CryptoOfflineStorage.set(this.key,_items),self.setListItems(_items,params),self},createValueObject:function(item){var obj={};return angular.forEach(this.fields,function(field){obj[field]=item[field]||""}),obj},setStorageType:function(storageType){return _storageType=storageType,this},setKey:function(key){return this.key=key,this},getKey:function(){return this.key},setListItems:function(items){return _items=items,this},getListItems:function(){return _items},setFields:function(fields){return this.fields=fields,this},countTotalItems:function(items){return(maxListItems(items,this.primaryKey)||0)+1},create:function(item){return item=this.createValueObject(item),item[this.primaryKey]=this.countTotalItems(_items),_items.push(item),CryptoOfflineStorage.set(this.key,_items),_items},update:function(item){var self=this;return _items=_items.map(function(element){return element[self.primaryKey]===item[self.primaryKey]&&(element=self.createValueObject(item)),element}),CryptoOfflineStorage.set(this.key,_items),_items},"delete":function(index){var db=this.getListItems(),self=this,_id=db.filter(function(element,pos){return element[self.primaryKey]===index?(element.pos=pos,element):void 0});if(_id.length>0){var item=db.splice(_id[0].pos,1);if("object"==typeof item[0])return this.setListItems(db),CryptoOfflineStorage.set(this.key,db),item[0]}return!1},clearAll:function(){return _items=[],CryptoOfflineStorage.clearAll()}}});
})(window, window.angular);